{% extends "base.html" %}

{% block head %}
    <title>Manage Accounts</title>
{% endblock %}

{% block body %}
<div class="container">
    <h2>Manage Accounts</h2>
    <div class="filter-form">
        <form method="GET" action="{{ url_for('admin_views.manage_accounts') }}">
            <!-- Account Type Filter -->
            <label for="account_type">Account Type:</label>
            <select name="account_type" id="account_type">
                <option value="">All</option>
                <option value="admin" {% if account_type == 'admin' %}selected{% endif %}>Admin</option>
                <option value="employer" {% if account_type == 'employer' %}selected{% endif %}>Employer</option>
                <option value="user" {% if account_type == 'user' %}selected{% endif %}>User</option>
            </select>

            <!-- Account Status Filter -->
            <label for="account_status">Account Status:</label>
            <select name="account_status" id="account_status">
                <option value="all" {% if account_status == 'all' %}selected{% endif %}>Show All</option>
                <option value="active" {% if account_status == 'active' %}selected{% endif %}>Only Active Accounts</option>
                <option value="locked" {% if account_status == 'locked' %}selected{% endif %}>Show Locked Accounts</option>
            </select>

            <!-- Search Query -->
            <input type="text" name="search" placeholder="Search..." value="{{ search_query }}">

            <button type="submit">Filter</button>
        </form>
    </div>

    <div class="create-account">
        <a href="{{ url_for('admin_views.create_account') }}" class="btn">Create New Account</a>
    </div>

    <table>
        <thead>
            <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Account Type</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for account in accounts %}
                <tr>
                    <td>{{ account.first_name }} {{ account.last_name }}</td>
                    <td>{{ account.email }}</td>
                    <td>
                        {% if account.__class__.__name__ == 'Admin' %}
                            Admin
                        {% elif account.__class__.__name__ == 'Employer' %}
                            Employer
                        {% elif account.__class__.__name__ == 'User' %}
                            User
                        {% else %}
                            -
                        {% endif %}
                    </td>
                    <td>
                        {% if account.__class__.__name__ == 'Admin' or account.__class__.__name__ == 'Employer' %}
                            {% if account.is_active %}
                                Active
                            {% elif account.account_locked %}
                                Locked
                            {% else %}
                                Inactive
                            {% endif %}
                        {% elif account.__class__.__name__ == 'User' %}
                            {% if account.is_active %}
                                Active
                            {% elif account.account_locked %}
                                Locked
                            {% else %}
                                Inactive
                            {% endif %}
                        {% else %}
                            -
                        {% endif %}
                    </td>
                    <td>
                        <a href="{{ url_for('admin_views.account_detail', account_type='admin' if account.__class__.__name__ == 'Admin' else 'employer' if account.__class__.__name__ == 'Employer' else 'user', account_id=account.admin_id if account.__class__.__name__ == 'Admin' else account.employer_id if account.__class__.__name__ == 'Employer' else account.user_id) }}" class="btn">View/Edit</a>
                        <form action="{{ url_for('admin_views.delete_account', account_type='admin' if account.__class__.__name__ == 'Admin' else 'employer' if account.__class__.__name__ == 'Employer' else 'user', account_id=account.admin_id if account.__class__.__name__ == 'Admin' else account.employer_id if account.__class__.__name__ == 'Employer' else account.user_id) }}" method="POST" style="display:inline;">
                            <button type="submit" class="btn delete-btn" onclick="return confirm('Are you sure you want to delete this account?')">Delete</button>
                        </form>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
