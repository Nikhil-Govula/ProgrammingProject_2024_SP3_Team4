{% extends "base.html" %}

{% block head %}
    <title>Edit Job Posting</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/edit_job.css') }}">
{% endblock %}

{% block body %}
<div id="notification-container" style="position: fixed; top: 20px; right: 20px; z-index: 1000;"></div>
<div class="content">
    <h2>Edit Job Posting</h2>
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="notification {{ category }}">{{ message }}</div>
            {% endfor %}
        {% endif %}
    {% endwith %}
    <form id="edit-job-form" method="POST">
        <!-- Job Title -->
        <div class="form-group">
            <label for="job_title">Job Title</label>
            <div class="dynamic-input-group">
                <input type="text" name="job_title" id="job_title" value="{{ job.job_title }}" required>
                <button type="button" class="update-field-button" data-field="job_title">Update</button>
            </div>
        </div>

        <!-- Job Description -->
        <div class="form-group">
            <label for="description">Job Description</label>
            <div class="dynamic-input-group">
                <textarea name="description" id="description" required>{{ job.description }}</textarea>
                <button type="button" class="update-field-button" data-field="description">Update</button>
            </div>
        </div>

        <!-- Requirements -->
        <div class="form-group">
            <label for="requirements">Requirements</label>
            <div class="dynamic-input-group">
                <textarea name="requirements" id="requirements" required>{{ job.requirements }}</textarea>
                <button type="button" class="update-field-button" data-field="requirements">Update</button>
            </div>
        </div>

        <!-- Salary -->
        <div class="form-group">
            <label for="salary">Salary</label>
            <div class="dynamic-input-group">
                <input type="number" name="salary" id="salary" value="{{ job.salary }}" required>
                <button type="button" class="update-field-button" data-field="salary">Update</button>
            </div>
        </div>

        <!-- City -->
        <div class="form-group">
            <label for="city">City</label>
            <div class="dynamic-input-group">
                <input type="text" name="city" id="city" value="{{ job.city }}, {{ job.country }}" placeholder="e.g., Perth, Australia" required>
                <button type="button" class="update-field-button" data-field="city">Update</button>
            </div>
        </div>

        <!-- Certifications Section -->
        <div class="form-group">
            <h3>Certifications</h3>
            <div>
                <label for="certification-input">Add a Certification:</label><br>
                <input type="text" id="certification-input" name="certification" placeholder="e.g., AWS Certified Solutions Architect" required>
                <button type="button" id="add-certification-button" class="add-input-button">Add Certification</button>
            </div>
        </div>

        <!-- Existing Certifications -->
        <div class="form-group">
            <label>Existing Certifications:</label>
            {% if job.certifications %}
                <ul id="certifications-list">
                    {% for cert in job.certifications %}
                        <li id="certification-{{ cert | replace(' ', '_') }}">
                            {{ cert }}
                            <button type="button" class="delete-certification-button" data-certification="{{ cert }}">Delete</button>
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p id="no-certifications-message">No certifications added.</p>
            {% endif %}
        </div>

        <!-- Skills Section -->
        <div class="form-group">
            <h3>Skills</h3>
            <div>
                <label for="skill-input">Add a Skill:</label><br>
                <input type="text" id="skill-input" name="skill" placeholder="e.g., Python" required>
                <button type="button" id="add-skill-button" class="add-input-button">Add Skill</button>
            </div>
        </div>

        <!-- Existing Skills -->
        <div class="form-group">
            <label>Existing Skills:</label>
            {% if job.skills %}
                <ul id="skills-list">
                    {% for skill in job.skills %}
                        <li id="skill-{{ skill | replace(' ', '_') }}">
                            {{ skill }}
                            <button type="button" class="delete-skill-button" data-skill="{{ skill }}">Delete</button>
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p id="no-skills-message">No skills added.</p>
            {% endif %}
        </div>

        <!-- Required Work History Section -->
        <div class="form-group">
            <h3>Required Work History</h3>
            <div>
                <label for="occupation-input">Occupation:</label><br>
                <input type="text" id="occupation-input" name="occupation" placeholder="e.g., Software Engineer" required>
                <label for="duration-input">Duration (months):</label><br>
                <input type="number" id="duration-input" name="duration" placeholder="e.g., 24" required>
                <button type="button" id="add-work-history-button" class="add-input-button">Add Work History</button>
            </div>
        </div>

        <!-- Existing Work History -->
        <div class="form-group">
            <label>Existing Work History:</label>
            {% if job.work_history %}
                <ul id="work-history-list">
                    {% for entry in job.work_history %}
                        <li id="work-history-{{ entry.occupation | replace(' ', '_') }}-{{ entry.duration }}">
                            <strong>{{ entry.occupation }}</strong> - {{ entry.duration }} month(s)
                            <button type="button" class="delete-work-history-button" data-occupation="{{ entry.occupation }}" data-duration="{{ entry.duration }}">Delete</button>
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p id="no-work-history-message">No work history entries added.</p>
            {% endif %}
        </div>

        <div class="form-group">
            <button type="button" id="delete-job-button" class="btn btn-danger">Delete Job</button>
        </div>
    </form>
</div>
{% endblock %}

{% block scripts %}
    <!-- Pass configuration variables to JavaScript -->
    <script>
        window.CONFIG = {
            citySuggestionsUrl: "{{ url_for('user_views.city_suggestions') }}",
            certificationSuggestionsUrl: "{{ url_for('user_views.certification_suggestions') }}",
            skillSuggestionsUrl: "{{ url_for('user_views.skill_suggestions') }}",
            occupationSuggestionsUrl: "{{ url_for('user_views.get_occupation_suggestions') }}",
            addJobCertificationUrl: "{{ url_for('employer_views.add_job_certification', job_id=job.job_id) }}",
            deleteJobCertificationUrl: "{{ url_for('employer_views.delete_job_certification', job_id=job.job_id) }}",
            addJobSkillUrl: "{{ url_for('employer_views.add_job_skill', job_id=job.job_id) }}",
            deleteJobSkillUrl: "{{ url_for('employer_views.delete_job_skill', job_id=job.job_id) }}",
            addWorkHistoryUrl: "{{ url_for('employer_views.add_work_history', job_id=job.job_id) }}",
            deleteWorkHistoryUrl: "{{ url_for('employer_views.delete_work_history', job_id=job.job_id) }}",
            editJobUrl: "{{ url_for('employer_views.edit_job', job_id=job.job_id) }}",
            deleteJobUrl: "{{ url_for('employer_views.delete_job', job_id=job.job_id) }}",
            viewJobsUrl: "{{ url_for('employer_views.view_jobs') }}"
        };
    </script>
    <!-- Include page-specific JavaScript -->
    <script src="{{ url_for('static', filename='js/edit_job.js') }}"></script>
{% endblock %}
