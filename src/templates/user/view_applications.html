{% extends 'base.html' %}

{% block head %}
<title>Your Applications</title>
<style>
    .view-applications-container {
        width: 50%;
        margin: 20px auto;
        padding: 20px;
        background-color: white;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    .application-card {
        display: flex;
        flex-direction: column;
        width: 100%;
        background-color: #ffffff;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
        transition: transform 0.2s ease-in-out;
    }

    .application-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .application-info-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 20px;
    }

    .status-badge {
        display: inline-block;
        padding: 5px 10px;
        border-radius: 15px;
        font-size: 1em;
        font-weight: 500;
    }

    .status-pending {
        background-color: #ffeeba;
        color: #856404;
    }

    .status-accepted {
        background-color: #d4edda;
        color: #155724;
    }

    .status-rejected {
        background-color: #f8d7da;
        color: #721c24;
    }

    .application-date {
        color: #666;
        font-size: 1em;
    }

    .view-job-button, .remove-job-button {
        display: inline-block;
        padding: 8px 16px;
        text-decoration: none;
        border-radius: 4px;
        transition: background-color 0.2s;
    }

    .view-job-button {
        background-color: #3498db;
        color: white;
    }

    .view-job-button:hover {
        background-color: #2980b9;
        text-decoration: none;
    }

    .remove-job-button {
        background-color: #e74c3c;
        color: white;
    }

    .remove-job-button:hover {
        background-color: #c0392b;
        text-decoration: none;
    }
</style>
{% endblock %}

{% block body %}
<div class="view-applications-container">
    <h1 class="section-heading">Your Job Applications</h1>
    <p>Track the status of your job applications below:</p>
    <div class="applications-list">
        {% if applications %}
            {% for application in applications %}
                <div class="application-card {% if not application.job %}inactive-job{% endif %}">
                    <h2>{{ application.job.job_title if application.job else 'Job Posting No Longer Available' }}</h2>
                    {% if application.job %}
                        <div class="company-info">
                            <p><strong>Company:</strong> {{ application.job.company_name }}</p>
                            <p><strong>Location:</strong> {{ application.job.city }}, {{ application.job.country }}</p>
                        </div>
                    {% else %}
                        <div class="job-status-message">
                            <p>This job posting has been removed or is no longer active.</p>
                        </div>
                    {% endif %}

                    <div class="application-info-container">
                        <div class="status-badge status-{{ application.status.lower() }}">
                            Status: {{ application.status }}
                        </div>
                        <div class="application-date">
                            Applied on: {{ application.date_applied[:10] }}
                        </div>
                        {% if application.job %}
                            <div>
                                <a href="{{ url_for('user_views.view_job_details', job_id=application.job_id) }}"
                                   class="view-job-button">View Job Details</a>
                            </div>
                        {% else %}
                            <div>
                                <a href="#" onclick="removeApplication('{{ application.application_id }}')"
                                   class="remove-job-button">Remove record!</a>
                            </div>
                        {% endif %}
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <div class="no-applications">
                <h3>No Applications Yet</h3>
                <p>You haven't applied for any jobs yet.</p>
                <p>Start your job search now!</p>
                <a href="{{ url_for('user_views.view_all_jobs') }}" class="view-job-button">
                    Browse Available Jobs
                </a>
            </div>
        {% endif %}
    </div>
</div>

<script>
    function removeApplication(applicationId) {
        fetch(`/user/remove_application/${applicationId}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                {% if csrf_token %}
                'X-CSRFToken': '{{ csrf_token() }}'
                {% endif %}
            },
        })
        .then(response => {
            if (response.ok) {
                // Handle successful removal, e.g., reload the page
                window.location.reload();
            } else {
                alert('Failed to remove job application.');
            }
        })
        .catch(error => {
            console.error('Error removing job application:', error);
        });
    }
</script>

{% endblock %}
